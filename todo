break up module_declaration_write into smaller functions
