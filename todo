add some const in module_declaration_write
break up module_declaration_write into smaller functions
